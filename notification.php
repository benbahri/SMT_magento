<?php$ref = $_GET['Reference'];$act = $_GET['Action'];$par = $_GET['Param'];require_once 'app/Mage.php';umask(0);Mage::app()->setCurrentStore(Mage_Core_Model_App::ADMIN_STORE_ID);//database read adapter $read = Mage::getSingleton('core/resource')->getConnection('core_read'); //database write adapter $write = Mage::getSingleton('core/resource')->getConnection('core_write');switch ($act){		case "DETAIL":		// accéder à la base et récuperer le montant 		$results = $read->fetchAll("SELECT base_grand_total FROM sales_flat_order WHERE increment_id=".$ref); 		foreach($results as $r)		{			$montant = number_format($r["base_grand_total"],3);		}		echo "Reference=".$ref. "&Action=".$act."&Reponse=".$montant;		break;			case "ERREUR":		// accéder à la base et mettre à jour l’état de la transaction		$write->update("sales_flat_order", array("status" => 'pending'), "increment_id=".$ref);		echo "Reference=".$ref. "&Action=".$act. "&Reponse=OK";		break;			case "ACCORD":		// accéder à la base,enregistrer le numéro d’autorisation (dans param)		$write->update("sales_flat_order", array("status" => 'complete', "param" => $par), "increment_id=".$ref);		echo "Reference=".$ref. "&Action=".$act. "&Reponse=OK";		break;			case "REFUS":		// accéder à la base et mettre à jour l’état de la transaction		$write->update("sales_flat_order", array("status" => 'holded'), "increment_id=".$ref);				echo "Reference=".$ref. "&Action=".$act. "&Reponse=OK";		break;			case "ANNULATION":		// accéder à la base et mettre à jour l’état de la transaction		$write->update("sales_flat_order", array("status" => 'canceled'), "increment_id=".$ref);				echo "Reference=".$ref."&Action=".$act."&Reponse=OK";		break;}